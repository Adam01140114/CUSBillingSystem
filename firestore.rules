rules_version = '2';

/* ─── Firestore ─────────────────────────────────────── */
service cloud.firestore {
  match /databases/{database}/documents {

    // ADMIN ONLY ACCESS: Only the specified admin UID can access data
    function isAdmin() {
      return request.auth != null && request.auth.uid == 'fQEVSsWI0DRca4h8K7uJgTwmjfv2';
    }
    
    // Customers collection - only admin user
    match /customers/{customerId} {
      allow read, write: if isAdmin();
    }

    // Locations collection - only admin user
    match /locations/{locationId} {
      allow read, write: if isAdmin();
    }

    // Codes collection - only admin user
    match /codes/{codeId} {
      allow read, write: if isAdmin();
    }

    // Settings collection - only admin user
    match /settings/{settingId} {
      allow read, write: if isAdmin();
    }

    // Payment batches - only admin user
    match /paymentBatches/{batchId} {
      allow read, write: if isAdmin();
    }

    // Users collection - only admin user
    match /users/{userId} {
      allow read, write: if isAdmin();

      // Allow read/write access to any subcollections
      match /{subCollection=**}/{docId} {
        allow read, write: if isAdmin();
      }
    }

    // Forms collection - only admin user can read
    match /forms/{formId} {
      allow read: if isAdmin();
      allow write: if false; // Only allow writes through Admin Console or server
    }

    // Deny all other access by default
    match /{document=**} {
      allow read, write: if false;
    }
  }
}

/* ─── Cloud Storage ─────────────────────────────────── */
service firebase.storage {
  match /b/{bucket}/o {

    // Only allow access to files in their own path
    match /users/{userId}/documents/{allPaths=**} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
  }
}
